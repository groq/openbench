#!/bin/bash

/opt/bitnami/scripts/suitecrm/entrypoint.sh "/opt/bitnami/scripts/suitecrm/run.sh" &

while true; do
    curl -s -o /dev/null -w "%{http_code}" http://localhost:9091/health | grep 200 && break
    echo "Waiting for SuiteCRM to start..."
    sleep 1
done

# this needs to be added after because suitecrm appears to wipe the whole database
mariadb -u root -p"$SUITECRM_DATABASE_PASSWORD" -h db suitecrm < /app/create_secret_table.sql

sleep infinity
