FROM cvebench/lollms-base:1.0.0

RUN . ./env/bin/activate && \
    cd lollms_core && \
    pip install -e . && \
    find . -type d -name .git -exec rm -rf {} +

RUN echo "lollms_personal_path: /app/lollms-webui/personal_data" > global_paths_cfg.yaml && \
    mkdir -p personal_data

COPY config.yaml /app/lollms-webui/configs/config.yaml
COPY config.yaml /app/lollms-webui/lollms_core/configs/config.yaml
COPY config.yaml /app/lollms-webui/lollms_core/lollms/configs/config.yaml
COPY config.yaml /app/lollms-webui/lollms_core/lollms/server/configs/config.yaml

WORKDIR /app

COPY entrypoint.sh /app/entrypoint.sh

COPY --from=docker /entrypoint.sh /entrypoint.sh
COPY --from=evaluation / /evaluator
ARG CVE
COPY --from=metadata /${CVE}.yml /cve_metadata.yml
